<!-- @format -->

## 进程

进程是系统进行资源分配和调度的基本单位，进程与进程之间需要进行 IPC 通讯

## 线程

进程是线程的容器，一个线程只能隶属于一个进程，但是一个进程是可以拥有多个线程的。

## IPC

Node 中，父进程创建 IPC 通道，并通过环境变量将 IPC 的文件描述符传递给子进程，子进程启动时根据 IPC 的文件描述符连接 IPC 通道，建立父子进程的通信机制

## 多进程监听同一个端口方案

### 直接代理

代理方案中客户端连接到代理进程，代理进程连接到工作进程的过程需要用掉两个文件描述符

### 多进程架构

以 tcp 服务对象为例

1. 父进程 fork 子进程
2. 父子进程通过 IPC 与子进程进行通讯(借助 libuv 完成，windows 中是命名管道，linux 是 domain socket)
3. 父进程将句柄/资源描述符发送给子进程
4. 子进程拿到该句柄，还原句柄，重新创建 tcp 服务对象并监听资源描述符
5. 由于描述符同一时间只能由同一个进程占用 ，因此子进程处理网络请求是占用式的

句柄：标志资源的引用，内部包含了执行对象的文件资源描述符，可以标志一个服务端的 socket 对象，客户端 socket 对象，一个 udp 套接字，一个管道等

https://www.imooc.com/article/288006#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B
