<!-- @format -->

## HTTP2 的问题

1. 建连延时，TCP+TSL/SSL 连接的建立都需要时间
2. TCP 队头阻塞：TCP 为了保证可靠传输，有一个超时重传机制，丢失的包必须等待重传确认。HTTP2 出现丢包时，整个 TCP 都要等待重传，会阻塞该 TCP 连接中的所有请求
3. 多路复用导致服务器压力上升
4. 大批量请求同时发送，多路复用容易超时

## HTTP3 运行在 QUIC(Quick UDP Internet Connection)之上的 HTTP 协议

重点是如何提升传输效率

1. 减少握手延迟(基于 UDP + TSL 1.3)
2. 实现了 HTTP/2 中的多路复用功能。和 TCP 不同，QUIC 实现了在同一物理连接上可以有多个独立的逻辑数据流实现了数据流的单独传输，就解决了 TCP 中队头阻塞的问题。
3. QPACK 压缩方案，压缩头部
4. 实现了类似 TCP 的流量控制、传输可靠性的功能。虽然 UDP 不提供可靠性的传输，但 QUIC 在 UDP 的基础 之上增加了一层来保证数据可靠性传输。它提供了数据包重传、拥塞控制以及其他一些 TCP 中存在的特性。

## TCP 特性

面向连接的，可靠的，基于字节流的；TCP 是工作在传输层的可靠数据协议，确保接收端接受的网络包是无损坏，无间隔，非冗余与按序的

1. 面向连接
2. 可靠
3. 字节流
4. 传输效率一般
5. 有流量控制(滑动窗口)
6. 拥塞控制(慢启动，拥塞避免，快重传与快恢复)
   6.1 慢启动，拥塞窗口指数增加
   6.2 拥塞避免：拥塞窗口线性增加，到达阈值
   6.3 快重传：收到三次相同的 ACK 拥塞窗口减半，再执行拥塞避免

### 滑动窗口与拥塞窗口

#### 滑动窗口

滑动窗口协议是传输层进行流控的一种措施，接收方通过通告发送方自己的窗口大小，从而控制发送方的发送速度，从而达到防止发送方发送速度过快而导致自己被淹没的目的。
TCP 的滑动窗口解决了端到端的流量控制问题，允许接受方对传输进行限制，直到它拥有足够的缓冲空间来容纳更多的数据。

#### 拥塞窗口

拥塞窗口指某一源端数据流在一个 RTT 内可以最多发送的**数据包数**,cwnd:发送端窗口( congestion window )。

##### 参考资料

https://www.cnblogs.com/taoshihan/p/11215329.html
https://blog.csdn.net/qq_42441693/article/details/102773890
https://zhuanlan.zhihu.com/p/76023663
https://www.xuebuyuan.com/105287.html

## UDP 特性

1. 无连接
2. 不可靠
   TCP 是有序的字节流；UDP 则是无序的。（这是由于 tcp 头部存在报文段的序号，而 udp 没有）
3. 传输内容：报文段
   面向报文的是指发送方的 UDP 对应用层交下来的数据报文，不合并不拆分，只是在其上面加上首部后就交给了下面的网络层。
   举个例子：
   发送方使用 TCP 协议先发送 100 个字节的包 1，再发送 10 个字节的包 2；等待 2 秒后，接收方只需要接收一次就能能将数据（110 字节）接收下来。
   发送方使用 UDP 协议先发送 100 个字节的包 1，再发送 10 个字节的包 2；等待 2 秒后，接收方必须要接收两次才能将包 1（100 字节）和包 2（10 字节）分别接收。
4. 传输效率：高于 TCP
   TCP 首部开销 20 字节（具有报文段序号，应答序号，窗口大小等）;UDP 的首部开销小，只有 8 个字节（2 个字节的源端口，2 个字节的目的端口，2 个字节的报文长度，2 个字节的校验和）。
5. 流量控制：无
6. 拥塞控制：无
7. TCP 首部较长 32 字节，UDP 只有 8 个字节

## 为什么 HTTP3 基于 UDP

TCP 有诸多缺点：握手耗时，队头阻塞。那么可能就会有人考虑到去修改 TCP 协议，其实这已经是一件不可能完成的任务了，因为 TCP 存在的时间实在太长，已经充斥在各种设备中，并且这个协议是由操作系统实现的，更新起来不大现实。
UDP 本身是无连接的、没有建链和拆链成本；UDP 的数据包无队头阻塞问题；UDP 改造成本小

#### 参考资料

https://blog.csdn.net/weixin_35804181/article/details/52584398
https://zhuanlan.zhihu.com/p/68012355
https://www.21ic.com/article/873225.html
