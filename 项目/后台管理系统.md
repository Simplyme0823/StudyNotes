<!-- @format -->

# 大背景

一个人做前后端，内部系统，PC，统一使用 chrome。所以不用考虑兼容问题，内网不用考虑网络差的情况，PC 端性能高于移动端。
布局方面统一使用 flex 布局；动态换肤：CSS 变量

# 权限设计

RBAC4
jwt:网络/jwt.md

## 系统菜单表

记录系统所有菜单

## 角色类别表

记录系统所有角色

## 用户信息表

记录系统所有用户信息

## 角色菜单权限表

记录每个角色对应菜单菜单

## 用户菜单对照表

记录每个 userID 对应菜单表

## 菜单生成

根据角色与用户个人的菜单权限生成最终的菜单配置，返回前端
前端根据菜单生成动态路由，某些按钮的权限可以记录在数据库表中，存入路由元信息

## Vue 动态路由坑：

在不刷新浏览器的情况下，切换登录账号，由于每次都是从后端返回配置表，生成动态路由
VueRouter 实例内部存在闭包，缓存路由信息，该闭包变量没有删除方法。

解决方法：登出时清空路由，重置 router 的 matcher 属性。方法优点：不用修改 VueRouter 源码

# 签核系统

使用第三方库：javascript-state-machine，对表单签核状态进行统一管理

# 绩效系统

原本是按照公司人员组织架构进行绩效打分，但是实际情况下人员结构更加复杂，比如在科长与部长内多出一个职级，或者某个职位确实，存在 leader 代管情况。
采用树结构，根据 pid/cid 构建父子关系。开放权限给各科室指定人员维护实际职级关系。
再基于树结构，给用户自定义绩效打分规则。

# 构建：webpack

1. Vue 脚手架有默认的 webpack 配置，自己添加了 eslint + premitter，用来对规范代码，不过 Vue 使用 webpack-chain 来配置的 webpack，一开始有点不习惯。
2. 使用 jenkins 代码自动化构建，定时轮询 svn 代码库，如果有代码提交就自动构建

# npm 脚本

在日常开发中，前端新建项目需要如下工作

1. views 文件夹/api 文件夹新建文件，且文件模板相同
2. 后台表中需要新加菜单信息，开发人员的页面权限分配

后端新建项目需要如下工作：

1. controller/service/路由文件都要新建文件，且文件模板相同

通过 npm 脚本自动完成这些工作

# typescript

前端 Vue2.0 对于 ts 支持差，后端可以良好地支持 ts，通过 ts 可以定义接口数据。

## 后续优化

错误监控：后端采用中间件捕捉错误，错误捕捉中间件放在最外层，因为中间件的原理是递归调用；对于定时任务的错误捕捉：采用 ts 装饰器
前端：运行时错误，promise 错误，vue 框架自带错误捕捉
关于资源加载错误：这里并没有考虑，因为是内网环境，不会出现此类错误。

上报的时候除堆栈信息外，还会上报用户信息，报错页面，网络请求参数等。
前端网络部分可以通过 axios 拦截器配置，不过错误上报的方式通过：beacon

Beacon 接口满足了分析和诊断代码的需要，这些代码通常会尝试在卸载文档之前将数据发送到 web 服务器。发送数据的任何过早时机都可能导致错失收集数据的机会。但是，确保在卸载文档期间发送数据是开发人员难以做到的。

难点：sourcemap 还原：https://github.com/mozilla/source-map
